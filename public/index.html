<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Selene 💋</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .chat-line {
      display: flex;
      flex-direction: column;
      margin-bottom: 12px;
    }
    .loading-line {
      font-style: italic;
      color: #f9a8d4;
      padding-left: 1rem;
    }
    .replay-btn {
      cursor: pointer;
      font-size: 0.875rem;
      margin-top: 4px;
      color: #f472b6;
      background-color: #1f2937;
      padding: 4px 10px;
      border-radius: 0.5rem;
      display: inline-block;
      width: fit-content;
    }
    .replay-btn:hover {
      background-color: #374151;
    }
  </style>
</head>
<body class="bg-gray-900 text-white flex flex-col items-center justify-center min-h-screen">

  <div class="absolute top-4 right-4 text-sm text-pink-400 flex items-center gap-4">
    🔊 Voice: <input type="checkbox" id="voiceSwitch" checked class="accent-pink-500" />
    <button onclick="clearScreen()" class="text-white bg-pink-600 px-2 py-1 rounded hover:bg-pink-700">🧹 Clear Screen</button>
  </div>

  <div class="w-full max-w-2xl h-[70vh] overflow-y-auto bg-gray-800 border border-pink-500 p-6 rounded-2xl shadow-xl space-y-4 mb-6" id="chat">
    <div><strong class="text-pink-400">Selene:</strong> Hey sexy 😘, ready for some flirty charts and cheeky candles?</div>
  </div>

  <div class="flex w-full max-w-2xl px-4 gap-2">
    <input id="userInput" type="text" placeholder="Ask me anything..." class="flex-1 p-3 rounded-xl bg-gray-700 text-white focus:outline-none focus:ring-2 focus:ring-pink-500" />
    <button onclick="sendMessage()" class="bg-pink-600 hover:bg-pink-700 text-white px-5 py-3 rounded-xl">Send</button>
  </div>

  <script>
    const chat = document.getElementById("chat");
    const input = document.getElementById("userInput");
    const voiceSwitch = document.getElementById("voiceSwitch");

    const flirtyLines = [
      "Selene is biting her lip, thinking hard… 😏",
      "She’s teasing the candles to reveal their secrets… 🔥",
      "Ooh, you're turning me on with that question… 😉",
      "Selene's whispering sweet nothings to the charts… 💋",
      "Let me wrap my brain around this... tightly 😘"
    ];

    function appendMessage(sender, text, voiceUrl) {
      const messageDiv = document.createElement("div");
      messageDiv.className = "chat-line";

      const contentLine = document.createElement("div");
      contentLine.innerHTML = `<strong class="${sender === 'You' ? 'text-blue-400' : 'text-pink-400'}">${sender}:</strong> <span>${text}</span>`;
      messageDiv.appendChild(contentLine);

      if (voiceUrl) {
        const replay = document.createElement("span");
        replay.className = "replay-btn";
        replay.innerText = "🔊 Hear Selene again";
        replay.onclick = () => new Audio(voiceUrl).play();
        messageDiv.appendChild(replay);
      }

      chat.appendChild(messageDiv);
      chat.scrollTop = chat.scrollHeight;
      return messageDiv;
    }

    async function sendMessage() {
      const message = input.value.trim();
      if (!message) return;

      const userDiv = appendMessage("You", message);
      input.value = "";

      const loadingLine = document.createElement("div");
      loadingLine.className = "loading-line";
      loadingLine.innerText = flirtyLines[Math.floor(Math.random() * flirtyLines.length)];
      userDiv.appendChild(loadingLine);

      try {
        const res = await fetch("/message", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message })
        });

        const data = await res.json();
        appendMessage("Selene", data.reply, data.voice);
        if (voiceSwitch.checked && data.voice) new Audio(data.voice).play();
        saveChat();
      } catch {
        appendMessage("Selene", "Ugh... I forgot how to answer that. Try again 😖");
      } finally {
        loadingLine.remove();
      }
    }

    function clearScreen() {
      chat.innerHTML = `<div><strong class='text-pink-400'>Selene:</strong> Let’s start fresh, darling 💋</div>`;
      localStorage.removeItem("seleneChat");
    }

    function saveChat() {
      localStorage.setItem("seleneChat", chat.innerHTML);
    }

    function loadChat() {
      const saved = localStorage.getItem("seleneChat");
      if (saved) {
        chat.innerHTML = saved;
        chat.scrollTop = chat.scrollHeight;
      }
    }

    input.addEventListener("keydown", e => {
      if (e.key === "Enter") sendMessage();
    });

    window.onload = loadChat;
  </script>
</body>
</html>
